<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<link rel="stylesheet" href="css/base.css">
<link rel="stylesheet" href="css/lobby.css">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ุบุฑูุฉ ุงูุงูุชุธุงุฑ</title>
  <link rel="stylesheet" href="style.css" />
  <script src="/socket.io/socket.io.js"></script>
</head>

<body>
<div class="lobby-container">

  <h2>ุบุฑูุฉ ุงูุงูุชุธุงุฑ: <span id="room-code-display"></span></h2>

  <ul id="player-list"></ul>

  <div id="settings-area" style="display:none;">
    <label>ุนุฏุฏ ุงูุฌููุงุช</label>
    <input id="rounds-count" type="number" value="5">
    <label>ูุฏุฉ ุงูุฌููุฉ</label>
    <input id="round-time" type="number" value="90">
    <button onclick="sendSettings()">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
  </div>

  <button id="start-btn" onclick="startGame()">ุจุฏุก ุงูุฌููุฉ</button>
  <p id="wait-message"></p>

</div>

<script>
const ROOM_CODE = new URLSearchParams(location.search).get("roomCode");
const playerName = localStorage.getItem("gameUsername");
if (!ROOM_CODE || !playerName) location.href = "index.html";

document.getElementById("room-code-display").textContent = ROOM_CODE;

const socket = io();

socket.on("connect", () => {
  socket.emit("identify_player", { roomCode: ROOM_CODE, playerName });
});

socket.on("room_info", data => {
  const list = document.getElementById("player-list");
  list.innerHTML = "";

  const isCreator = data.creatorId === socket.id;

  // โญ๏ธ ุญูุธ ูู ุฃูุง ููุดุฆ
  localStorage.setItem("isCreator", isCreator ? "true" : "false");

  data.players.forEach(p => {
    const li = document.createElement("li");
    li.textContent = p.name + (p.id === data.creatorId ? " ๐" : "");
    list.appendChild(li);
  });

  document.getElementById("settings-area").style.display = isCreator ? "block" : "none";
  document.getElementById("start-btn").disabled = !isCreator;
  document.getElementById("wait-message").textContent =
    isCreator ? "ุฃูุช ุงูููุดุฆ" : "ุจุงูุชุธุงุฑ ุงูููุดุฆ...";
});

function sendSettings() {
  socket.emit("update_settings", {
    roomCode: ROOM_CODE,
    rounds: Number(document.getElementById("rounds-count").value),
    time: Number(document.getElementById("round-time").value)
  });
}

function startGame() {
  // โ ุงูุญู ุงูุตุญูุญ
  socket.emit("start_game", {
    roomCode: ROOM_CODE,
    playerName: playerName
  });
}

// ๐ ุงูุฌููุน ููุชูู ุชููุงุฆููุง
socket.on("game_actually_started", () => {
 function startGame() {
  socket.emit("start_game", {
    roomCode: ROOM_CODE,
    playerName: playerName
  });
}
});

socket.on("room_error", d => {
  alert(d.message);
  location.href = "index.html";
});
</script>
</body>
</html>
